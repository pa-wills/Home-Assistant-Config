activate_abc_radio:
  alias: 'Activate ABC Local Radio on the kitchen Sonos'
  sequence:
    - service: media_player.select_source
      data:
        entity_id: media_player.kitchen
        source: '936 ABC Hobart'
    - service: media_player.media_play
      data:
        entity_id: media_player.kitchen
    - service: media_player.volume_set
      data:
        entity_id: media_player.kitchen
        volume_level: 0.2

activate_netflix:
  alias: 'Activate Netflix on the primary TV'
  sequence:
    - service: script.turn_on
      data_template:
        entity_id: >
          {% if is_state('media_player.lg_webos_smart_tv', 'off') %}
            script.toggle_tv_power_state
            # Do I then need to wait?
          {% endif %}

    # INVARIANT: The TV's and Roku's respective media_player entities must now be up.
    - service: media_player.select_source
      data:
        entity_id: media_player.lg_webos_smart_tv
        source: 'HDMI2'
    - service: media_player.select_source
      data:
        entity_id: media_player.roku_yl00at185320
        source: 'Netflix'

handle_alert_motion_detected_anywhere_unoccupied:
  alias: 'Handle Motion Detected when house is Unoccupied'
  sequence:
    # Do nothing if an alert has been sent within last 5 mins.
    - condition: template
      value_template: >
        {% if ((now().timestamp() - state_attr('input_datetime.datetime_last_alerted_motion_anywhere_unoccupied', 'timestamp')) > 300) %}
          true
        {% else %}
          false
        {% endif %}
    - service: input_datetime.set_datetime
      entity_id: input_datetime.datetime_last_alerted_motion_anywhere_unoccupied
      data_template:
        datetime: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
    - service: notify.petes_ios_devices
      data:
        title: "Security Alarm"
        message: "Motion detected in the House (despite neither of you being home)"

handle_alert_motion_detected_eaves:
  alias: 'Handle Motion Detected in the Eaves'
  sequence:
    # Do nothing if an alert has been sent within last 5 mins.
    - condition: template
      value_template: >
        {% if ((now().timestamp() - state_attr('input_datetime.datetime_last_alerted_motion_eaves', 'timestamp')) > 300) %}
          true
        {% else %}
          false
        {% endif %}
    - service: input_datetime.set_datetime
      entity_id: input_datetime.datetime_last_alerted_motion_eaves
      data_template:
        datetime: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
    - service: notify.petes_ios_devices
      data:
        title: "Motion Alarm"
        message: "Motion detected in the Eaves."

handle_alert_motion_detected_during_evie_sleep_mode:
  alias: 'Handle Motion Detected during Evie Sleep Mode'
  sequence:
    # Do nothing if an alert has been sent within last 5 mins.
    - condition: template
      value_template: >
        {% if ((now().timestamp() - state_attr('input_datetime.datetime_last_alerted_motion_evie_sleep_mode', 'timestamp')) > 300) %}
          true
        {% else %}
          false
        {% endif %}
    - service: input_datetime.set_datetime
      entity_id: input_datetime.datetime_last_alerted_motion_evie_sleep_mode
      data_template:
        datetime: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
    - service: notify.petes_ios_devices
      data:
        title: "Motion Alarm"
        message: "Motion detected in Evie's Bedroom."

toggle_tv_power_state:
  alias: "Equivalent of pressing the power-toggle button."
  sequence:
    - service: switch.turn_off
      data:
        entity_id: switch.tv_lg_power